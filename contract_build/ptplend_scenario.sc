[{"shortname": "P2PLend", "longname": "P2PLend", "scenario": [{"action": "html", "tag": "h1", "inner": "Simple Interest P2P Lending", "line_no": 152}, {"action": "html", "tag": "p", "inner": "[[TABLEOFCONTENTS]]", "line_no": 154}, {"action": "html", "tag": "h1", "inner": "Accounts", "line_no": 162}, {"action": "show", "html": true, "stripStrings": false, "expression": "(list 163 (account_of_seed \"Administrator\" 157) (account_of_seed \"Alice\" 158) (account_of_seed \"Robert\" 159))", "line_no": 163}, {"action": "html", "tag": "h1", "inner": "Contract", "line_no": 165}, {"action": "html", "tag": "h1", "inner": "Entry points", "line_no": 168}, {"action": "newContract", "id": 0, "export": "(storage (record 28 (administrator (reduce (attr (account_of_seed \"Administrator\" 157) \"address\" 157) 157)) (balances (type_annotation (big_map 24 ) (bigmap (unknown 2) (record ((balance \"nat\")) None)) 24)) (loans (type_annotation (map 18 ) (map \"nat\" (record ((amount \"nat\") (borrower \"address\") (collateral \"nat\") (duration \"int\") (lender \"address\") (lent \"bool\") (paid \"bool\") (payback \"nat\") (req \"bool\") (starttime \"timestamp\")) None)) 18)) (noLoans (literal (intOrNat 0) 28)) (totalSupply (literal (intOrNat 0) 28)))\nstorage_type (())\nmessages ((borrowreq True ((verify (ge (sub (attr (getItem (attr (data) \"balances\" 33) (sender) 33) \"balance\" 33) (attr (params 31) \"qty\" 28) 33) (literal (intOrNat 0) 33) 33) False 33) (set (attr (data) \"noLoans\" 46) (add (attr (data) \"noLoans\" 46) (literal (intOrNat 1) 46) 46) 46) (set (getItem (attr (data) \"loans\" 47) (attr (data) \"noLoans\" 46) 47) (record 44 (amount (attr (params 31) \"qty\" 28)) (borrower (sender)) (collateral (attr (params 31) \"qty\" 28)) (duration (attr (params 31) \"dur\" 28)) (lender (sender)) (lent (literal (bool False) 44)) (paid (literal (bool False) 44)) (payback (truediv (mul (attr (params 31) \"qty\" 28) (literal (intOrNat 108) 40) 40) (literal (intOrNat 100) 40) 40)) (req (literal (bool True) 44)) (starttime (literal (timestamp 0) 38))) 47) (set (attr (getItem (attr (data) \"balances\" 33) (attr (data) \"administrator\" 48) 48) \"balance\" 48) (add (attr (getItem (attr (data) \"balances\" 33) (attr (data) \"administrator\" 48) 48) \"balance\" 48) (attr (params 31) \"qty\" 28) 48) 48) (set (attr (getItem (attr (data) \"balances\" 33) (sender) 49) \"balance\" 49) (openVariant (isNat (sub (attr (getItem (attr (data) \"balances\" 33) (sender) 49) \"balance\" 49) (attr (params 31) \"qty\" 28) 49) 49) \"Some\" 49) 49))) (defaultor True ((verify (eq (sender) (attr (data) \"administrator\" 48) 80) False 80) (verify (gt (attr (getItem (attr (data) \"loans\" 47) (params 77) 79) \"duration\" 81) (sub (literal (timestamp 1595752470) 81) (attr (getItem (attr (data) \"loans\" 47) (params 77) 79) \"starttime\" 81) 81) 81) False 81) (verify (eq (attr (getItem (attr (data) \"loans\" 47) (params 77) 82) \"lent\" 82) (literal (bool True) 82) 82) False 82) (set (attr (getItem (attr (data) \"balances\" 33) (sender) 84) \"balance\" 84) (openVariant (isNat (sub (attr (getItem (attr (data) \"balances\" 33) (sender) 84) \"balance\" 84) (attr (getItem (attr (data) \"loans\" 47) (params 77) 79) \"collateral\" 84) 84) 84) \"Some\" 84) 84) (set (attr (getItem (attr (data) \"balances\" 33) (attr (getItem (attr (data) \"loans\" 47) (params 77) 79) \"lender\" 85) 85) \"balance\" 85) (add (attr (getItem (attr (data) \"balances\" 33) (attr (getItem (attr (data) \"loans\" 47) (params 77) 79) \"lender\" 85) 85) \"balance\" 85) (attr (getItem (attr (data) \"loans\" 47) (params 77) 79) \"collateral\" 84) 85) 85))) (getAdministrator True ((set (operations 107) (cons (transfer (attr (data) \"administrator\" 48) (literal (mutez 0) 107) (openVariant (contract \"viewAdministrator\" \"address\" (attr (params 105) \"contractAddress\" 107) 107) \"Some\" 107) 107) (operations 107) 107) 107))) (getBalance True ((set (operations 103) (cons (transfer (attr (getItem (attr (data) \"balances\" 33) (attr (attr (params 101) \"arg\" 103) \"owner\" 103) 103) \"balance\" 103) (literal (mutez 0) 103) (openVariant (contract \"viewBalance\" \"nat\" (attr (params 101) \"contractAddress\" 103) 103) \"Some\" 103) 103) (operations 103) 103) 103))) (getLoans True ((set (operations 111) (cons (transfer (attr (data) \"noLoans\" 46) (literal (mutez 0) 111) (openVariant (contract \"viewLoans\" \"nat\" (attr (params 109) \"contractAddress\" 111) 111) \"Some\" 111) 111) (operations 111) 111) 111))) (getTotalSupply True ((set (operations 116) (cons (transfer (attr (data) \"totalSupply\" 116) (literal (mutez 0) 116) (openVariant (contract \"viewTotalSupply\" \"nat\" (attr (params 114) \"contractAddress\" 116) 116) \"Some\" 116) 116) (operations 116) 116) 116))) (lend True ((verify (ge (attr (getItem (attr (data) \"loans\" 47) (params 51) 53) \"amount\" 54) (attr (getItem (attr (data) \"balances\" 33) (sender) 54) \"balance\" 54) 54) False 54) (verify (eq (attr (getItem (attr (data) \"loans\" 47) (params 51) 53) \"req\" 55) (literal (bool True) 55) 55) False 55) (set (attr (getItem (attr (data) \"loans\" 47) (params 51) 56) \"lent\" 56) (literal (bool True) 56) 56) (set (attr (getItem (attr (data) \"loans\" 47) (params 51) 57) \"lender\" 57) (sender) 57) (set (attr (getItem (attr (data) \"balances\" 33) (attr (getItem (attr (data) \"loans\" 47) (params 51) 53) \"borrower\" 58) 58) \"balance\" 58) (add (attr (getItem (attr (data) \"balances\" 33) (attr (getItem (attr (data) \"loans\" 47) (params 51) 53) \"borrower\" 58) 58) \"balance\" 58) (attr (getItem (attr (data) \"loans\" 47) (params 51) 53) \"amount\" 54) 58) 58) (set (attr (getItem (attr (data) \"balances\" 33) (sender) 59) \"balance\" 59) (openVariant (isNat (sub (attr (getItem (attr (data) \"balances\" 33) (sender) 59) \"balance\" 59) (attr (getItem (attr (data) \"loans\" 47) (params 51) 53) \"amount\" 54) 59) 59) \"Some\" 59) 59) (set (attr (getItem (attr (data) \"loans\" 47) (params 51) 60) \"starttime\" 60) (literal (timestamp 1595752470) 60) 60))) (mint True ((set_type (params 93) (record ((address \"address\") (value \"nat\")) None) 95) (verify (eq (sender) (attr (data) \"administrator\" 48) 96) False 96) (ifBlock (invert (contains (attr (data) \"balances\" 33) (attr (params 93) \"address\" 97) 119) 119) ((set (getItem (attr (data) \"balances\" 33) (attr (params 93) \"address\" 97) 120) (record 120 (balance (literal (intOrNat 0) 120))) 120)) 119) (set (attr (getItem (attr (data) \"balances\" 33) (attr (params 93) \"address\" 97) 98) \"balance\" 98) (add (attr (getItem (attr (data) \"balances\" 33) (attr (params 93) \"address\" 97) 98) \"balance\" 98) (attr (params 93) \"value\" 98) 98) 98) (set (attr (data) \"totalSupply\" 116) (add (attr (data) \"totalSupply\" 116) (attr (params 93) \"value\" 98) 99) 99))) (paid True ((verify (eq (attr (getItem (attr (data) \"loans\" 47) (attr (params 63) \"index\" 28) 65) \"borrower\" 66) (sender) 66) False 66) (verify (ge (attr (params 63) \"amount\" 28) (attr (getItem (attr (data) \"loans\" 47) (attr (params 63) \"index\" 28) 65) \"payback\" 67) 67) False 67) (verify (ge (attr (getItem (attr (data) \"loans\" 47) (attr (params 63) \"index\" 28) 65) \"duration\" 68) (sub (literal (timestamp 1595752470) 68) (attr (getItem (attr (data) \"loans\" 47) (attr (params 63) \"index\" 28) 65) \"starttime\" 68) 68) 68) False 68) (verify (eq (attr (getItem (attr (data) \"loans\" 47) (attr (params 63) \"index\" 28) 69) \"lent\" 69) (literal (bool True) 69) 69) False 69) (set (attr (getItem (attr (data) \"balances\" 33) (sender) 71) \"balance\" 71) (openVariant (isNat (sub (attr (getItem (attr (data) \"balances\" 33) (sender) 71) \"balance\" 71) (attr (getItem (attr (data) \"loans\" 47) (attr (params 63) \"index\" 28) 65) \"payback\" 67) 71) 71) \"Some\" 71) 71) (set (attr (getItem (attr (data) \"balances\" 33) (sender) 72) \"balance\" 72) (add (attr (getItem (attr (data) \"balances\" 33) (sender) 72) \"balance\" 72) (attr (getItem (attr (data) \"loans\" 47) (attr (params 63) \"index\" 28) 65) \"collateral\" 72) 72) 72) (set (attr (getItem (attr (data) \"balances\" 33) (attr (data) \"administrator\" 48) 73) \"balance\" 73) (openVariant (isNat (sub (attr (getItem (attr (data) \"balances\" 33) (attr (data) \"administrator\" 48) 73) \"balance\" 73) (attr (getItem (attr (data) \"loans\" 47) (attr (params 63) \"index\" 28) 65) \"collateral\" 72) 73) 73) \"Some\" 73) 73) (set (attr (getItem (attr (data) \"balances\" 33) (attr (getItem (attr (data) \"loans\" 47) (attr (params 63) \"index\" 28) 65) \"lender\" 74) 74) \"balance\" 74) (add (attr (getItem (attr (data) \"balances\" 33) (attr (getItem (attr (data) \"loans\" 47) (attr (params 63) \"index\" 28) 65) \"lender\" 74) 74) \"balance\" 74) (attr (getItem (attr (data) \"loans\" 47) (attr (params 63) \"index\" 28) 65) \"payback\" 67) 74) 74))) (setAdministrator True ((set_type (params 87) \"address\" 89) (verify (eq (sender) (attr (data) \"administrator\" 48) 90) False 90) (set (attr (data) \"administrator\" 48) (params 87) 91))))\nflags ()\nglobals ()\nstorage_layout ()\nentry_points_layout ())", "line_no": 169, "show": true, "accept_unknown_types": false}, {"action": "html", "tag": "h2", "inner": "Admin mints a few coins", "line_no": 171}, {"action": "message", "id": 0, "message": "mint", "params": "(record 172 (address (reduce (attr (account_of_seed \"Administrator\" 157) \"address\" 157) 157)) (value (literal (intOrNat 1000) 172)))", "line_no": 172, "title": "", "messageClass": "", "source": "none", "sender": "seed:Administrator", "chain_id": "", "time": 0, "amount": "(literal (mutez 0) 1)", "show": true, "valid": true}, {"action": "html", "tag": "h2", "inner": "Admin mints a few coins for Alice", "line_no": 174}, {"action": "message", "id": 0, "message": "mint", "params": "(record 175 (address (reduce (attr (account_of_seed \"Alice\" 158) \"address\" 158) 158)) (value (literal (intOrNat 100) 175)))", "line_no": 175, "title": "", "messageClass": "", "source": "none", "sender": "seed:Administrator", "chain_id": "", "time": 0, "amount": "(literal (mutez 0) 1)", "show": true, "valid": true}, {"action": "html", "tag": "h2", "inner": "Admin mints a few coins for Bob", "line_no": 177}, {"action": "message", "id": 0, "message": "mint", "params": "(record 178 (address (reduce (attr (account_of_seed \"Robert\" 159) \"address\" 159) 159)) (value (literal (intOrNat 100) 178)))", "line_no": 178, "title": "", "messageClass": "", "source": "none", "sender": "seed:Administrator", "chain_id": "", "time": 0, "amount": "(literal (mutez 0) 1)", "show": true, "valid": true}, {"action": "html", "tag": "h2", "inner": "Alice issues a loan request value: 10", "line_no": 181}, {"action": "message", "id": 0, "message": "borrowreq", "params": "(record 182 (dur (literal (intOrNat 86400) 182)) (qty (literal (intOrNat 100) 182)))", "line_no": 182, "title": "", "messageClass": "", "source": "none", "sender": "seed:Alice", "chain_id": "", "time": 0, "amount": "(literal (mutez 0) 1)", "show": true, "valid": true}, {"action": "verify", "condition": "(eq (attr (contractData 0 182) \"noLoans\" 183) (literal (intOrNat 1) 183) 183)", "line_no": 183}, {"action": "verify", "condition": "(eq (attr (getItem (attr (contractData 0 182) \"balances\" 184) (reduce (attr (account_of_seed \"Alice\" 158) \"address\" 158) 158) 184) \"balance\" 184) (literal (intOrNat 0) 184) 184)", "line_no": 184}, {"action": "verify", "condition": "(eq (attr (getItem (attr (contractData 0 182) \"balances\" 184) (reduce (attr (account_of_seed \"Administrator\" 157) \"address\" 157) 157) 185) \"balance\" 185) (literal (intOrNat 1100) 185) 185)", "line_no": 185}, {"action": "html", "tag": "h2", "inner": "Bob wants to approve the loan", "line_no": 187}, {"action": "message", "id": 0, "message": "lend", "params": "(literal (intOrNat 1) 188)", "line_no": 188, "title": "", "messageClass": "", "source": "none", "sender": "seed:Robert", "chain_id": "", "time": 0, "amount": "(literal (mutez 0) 1)", "show": true, "valid": true}, {"action": "verify", "condition": "(eq (attr (getItem (attr (contractData 0 188) \"balances\" 189) (reduce (attr (account_of_seed \"Alice\" 158) \"address\" 158) 158) 189) \"balance\" 189) (literal (intOrNat 100) 189) 189)", "line_no": 189}, {"action": "verify", "condition": "(eq (attr (getItem (attr (contractData 0 188) \"balances\" 189) (reduce (attr (account_of_seed \"Robert\" 159) \"address\" 159) 159) 190) \"balance\" 190) (literal (intOrNat 0) 190) 190)", "line_no": 190}, {"action": "html", "tag": "h2", "inner": "Admin mints a few coins for Alice", "line_no": 192}, {"action": "message", "id": 0, "message": "mint", "params": "(record 193 (address (reduce (attr (account_of_seed \"Alice\" 158) \"address\" 158) 158)) (value (literal (intOrNat 8) 193)))", "line_no": 193, "title": "", "messageClass": "", "source": "none", "sender": "seed:Administrator", "chain_id": "", "time": 0, "amount": "(literal (mutez 0) 1)", "show": true, "valid": true}, {"action": "html", "tag": "h2", "inner": "Alice wants to pay back the loan", "line_no": 195}, {"action": "message", "id": 0, "message": "paid", "params": "(record 196 (amount (literal (intOrNat 108) 196)) (index (literal (intOrNat 1) 196)))", "line_no": 196, "title": "", "messageClass": "", "source": "none", "sender": "seed:Alice", "chain_id": "", "time": 0, "amount": "(literal (mutez 0) 1)", "show": true, "valid": true}, {"action": "verify", "condition": "(eq (attr (getItem (attr (contractData 0 196) \"balances\" 197) (reduce (attr (account_of_seed \"Alice\" 158) \"address\" 158) 158) 197) \"balance\" 197) (literal (intOrNat 100) 197) 197)", "line_no": 197}, {"action": "verify", "condition": "(eq (attr (getItem (attr (contractData 0 196) \"balances\" 197) (reduce (attr (account_of_seed \"Robert\" 159) \"address\" 159) 159) 198) \"balance\" 198) (literal (intOrNat 108) 198) 198)", "line_no": 198}, {"action": "verify", "condition": "(eq (attr (getItem (attr (contractData 0 196) \"balances\" 197) (reduce (attr (account_of_seed \"Administrator\" 157) \"address\" 157) 157) 199) \"balance\" 199) (literal (intOrNat 1000) 199) 199)", "line_no": 199}, {"action": "html", "tag": "h1", "inner": "Views", "line_no": 202}, {"action": "newContract", "id": 1, "export": "(storage (record 127 )\nstorage_type (())\nmessages ((viewAdministrator True ((set_type (params 133) \"address\" 135))) (viewBalance True ((set_type (params 129) \"nat\" 131))) (viewLoans True ((set_type (params 141) \"nat\" 143))) (viewTotalSupply True ((set_type (params 137) \"nat\" 139))))\nflags ()\nglobals ()\nstorage_layout ()\nentry_points_layout ())", "line_no": 204, "show": true, "accept_unknown_types": false}, {"action": "html", "tag": "h2", "inner": "Balance", "line_no": 205}, {"action": "message", "id": 0, "message": "getBalance", "params": "(record 206 (arg (record 206 (owner (reduce (attr (account_of_seed \"Robert\" 159) \"address\" 159) 159)))) (contractAddress (literal (local-address 1) 127)))", "line_no": 206, "title": "", "messageClass": "", "source": "none", "sender": "none", "chain_id": "", "time": 0, "amount": "(literal (mutez 0) 1)", "show": true, "valid": true}, {"action": "html", "tag": "h2", "inner": "Administrator", "line_no": 208}, {"action": "message", "id": 0, "message": "getAdministrator", "params": "(record 209 (contractAddress (literal (local-address 1) 127)))", "line_no": 209, "title": "", "messageClass": "", "source": "none", "sender": "none", "chain_id": "", "time": 0, "amount": "(literal (mutez 0) 1)", "show": true, "valid": true}, {"action": "html", "tag": "h2", "inner": "Total Supply", "line_no": 211}, {"action": "message", "id": 0, "message": "getTotalSupply", "params": "(record 212 (contractAddress (literal (local-address 1) 127)))", "line_no": 212, "title": "", "messageClass": "", "source": "none", "sender": "none", "chain_id": "", "time": 0, "amount": "(literal (mutez 0) 1)", "show": true, "valid": true}, {"action": "html", "tag": "h2", "inner": "Loans", "line_no": 214}, {"action": "message", "id": 0, "message": "getLoans", "params": "(record 215 (contractAddress (literal (local-address 1) 127)))", "line_no": 215, "title": "", "messageClass": "", "source": "none", "sender": "none", "chain_id": "", "time": 0, "amount": "(literal (mutez 0) 1)", "show": true, "valid": true}]}]