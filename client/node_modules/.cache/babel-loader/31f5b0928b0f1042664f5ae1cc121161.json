{"ast":null,"code":"\"use strict\";\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\n  result[\"default\"] = mod;\n  return result;\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nconst blakejs = __importStar(require(\"blakejs\"));\n\nconst jsonpath_plus_1 = require(\"jsonpath-plus\");\n\nconst TezosLanguageUtil_1 = require(\"../TezosLanguageUtil\");\n\nconst TezosNodeReader_1 = require(\"../TezosNodeReader\");\n\nconst TezosNodeWriter_1 = require(\"../TezosNodeWriter\");\n\nconst TezosTypes = __importStar(require(\"../../../types/tezos/TezosChainTypes\"));\n\nconst TezosConstants_1 = require(\"../../../types/tezos/TezosConstants\");\n\nvar BabylonDelegationHelper;\n\n(function (BabylonDelegationHelper) {\n  function verifyDestination(server, address) {\n    return __awaiter(this, void 0, void 0, function* () {\n      const contract = yield TezosNodeReader_1.TezosNodeReader.getAccountForBlock(server, 'head', address);\n\n      if (!!!contract.script) {\n        throw new Error(`No code found at ${address}`);\n      }\n\n      const k = Buffer.from(blakejs.blake2s(JSON.stringify(contract.script.code), null, 16)).toString('hex');\n\n      if (k !== 'd99cb8b4c7e40166f59c0f3c30724225') {\n        throw new Error(`Contract does not match the expected code hash: ${k}, 'd99cb8b4c7e40166f59c0f3c30724225'`);\n      }\n\n      return true;\n    });\n  }\n\n  BabylonDelegationHelper.verifyDestination = verifyDestination;\n\n  function verifyScript(script) {\n    const k = Buffer.from(blakejs.blake2s(TezosLanguageUtil_1.TezosLanguageUtil.preProcessMichelsonScript(script).join('\\n'), null, 16)).toString('hex');\n\n    if (k !== 'a585489ffaee60d07077059539d5bfc8') {\n      throw new Error(`Contract does not match the expected code hash: ${k}, 'a585489ffaee60d07077059539d5bfc8'`);\n    }\n\n    return true;\n  }\n\n  BabylonDelegationHelper.verifyScript = verifyScript;\n\n  function getSimpleStorage(server, address) {\n    return __awaiter(this, void 0, void 0, function* () {\n      const storageResult = yield TezosNodeReader_1.TezosNodeReader.getContractStorage(server, address);\n      return {\n        administrator: jsonpath_plus_1.JSONPath({\n          path: '$.string',\n          json: storageResult\n        })[0]\n      };\n    });\n  }\n\n  BabylonDelegationHelper.getSimpleStorage = getSimpleStorage;\n\n  function setDelegate(server, keyStore, contract, delegate, fee, derivationPath = '') {\n    if (contract.startsWith('KT1')) {\n      const parameters = `[{ \"prim\": \"DROP\" }, { \"prim\": \"NIL\", \"args\": [{ \"prim\": \"operation\" }] }, { \"prim\": \"PUSH\", \"args\": [{ \"prim\": \"key_hash\" }, { \"string\": \"${delegate}\" } ] }, { \"prim\": \"SOME\" }, { \"prim\": \"SET_DELEGATE\" }, { \"prim\": \"CONS\" } ]`;\n      return TezosNodeWriter_1.TezosNodeWriter.sendContractInvocationOperation(server, keyStore, contract, 0, fee, derivationPath, 0, TezosConstants_1.TezosConstants.P005ManagerContractWithdrawalGasLimit, 'do', parameters, TezosTypes.TezosParameterFormat.Micheline);\n    } else {\n      return TezosNodeWriter_1.TezosNodeWriter.sendDelegationOperation(server, keyStore, delegate, fee, derivationPath);\n    }\n  }\n\n  BabylonDelegationHelper.setDelegate = setDelegate;\n\n  function unSetDelegate(server, keyStore, contract, fee, derivationPath = '') {\n    if (contract.startsWith('KT1')) {\n      const parameters = `[{ \"prim\": \"DROP\" }, { \"prim\": \"NIL\", \"args\": [{ \"prim\": \"operation\" }] }, { \"prim\": \"NONE\", \"args\": [{ \"prim\": \"key_hash\" }] }, { \"prim\": \"SET_DELEGATE\" }, { \"prim\": \"CONS\" } ]`;\n      return TezosNodeWriter_1.TezosNodeWriter.sendContractInvocationOperation(server, keyStore, contract, 0, fee, derivationPath, 0, TezosConstants_1.TezosConstants.P005ManagerContractWithdrawalGasLimit, 'do', parameters, TezosTypes.TezosParameterFormat.Micheline);\n    } else {\n      return TezosNodeWriter_1.TezosNodeWriter.sendUndelegationOperation(server, keyStore, fee, derivationPath);\n    }\n  }\n\n  BabylonDelegationHelper.unSetDelegate = unSetDelegate;\n\n  function withdrawDelegatedFunds(server, keyStore, contract, fee, amount, derivationPath = '') {\n    return sendDelegatedFunds(server, keyStore, contract, fee, amount, derivationPath, keyStore.publicKeyHash);\n  }\n\n  BabylonDelegationHelper.withdrawDelegatedFunds = withdrawDelegatedFunds;\n\n  function sendDelegatedFunds(server, keyStore, contract, fee, amount, derivationPath = '', destination) {\n    let parameters = `[ { \"prim\": \"DROP\" },\n            { \"prim\": \"NIL\", \"args\": [ { \"prim\": \"operation\" } ] },\n            { \"prim\": \"PUSH\", \"args\": [ { \"prim\": \"key_hash\" }, { \"string\": \"${destination}\" } ] },\n            { \"prim\": \"IMPLICIT_ACCOUNT\" },\n            { \"prim\": \"PUSH\", \"args\": [ { \"prim\": \"mutez\" }, { \"int\": \"${amount}\" } ] },\n            { \"prim\": \"UNIT\" },\n            { \"prim\": \"TRANSFER_TOKENS\" },\n            { \"prim\": \"CONS\" } ]`;\n    return TezosNodeWriter_1.TezosNodeWriter.sendContractInvocationOperation(server, keyStore, contract, 0, fee, derivationPath, TezosConstants_1.TezosConstants.P005ManagerContractWithdrawalStorageLimit, TezosConstants_1.TezosConstants.P005ManagerContractWithdrawalGasLimit, 'do', parameters, TezosTypes.TezosParameterFormat.Micheline);\n  }\n\n  BabylonDelegationHelper.sendDelegatedFunds = sendDelegatedFunds;\n\n  function depositDelegatedFunds(server, keyStore, contract, fee, amount, derivationPath = '') {\n    return TezosNodeWriter_1.TezosNodeWriter.sendContractInvocationOperation(server, keyStore, contract, amount, fee, derivationPath, 0, TezosConstants_1.TezosConstants.P005ManagerContractDepositGasLimit, undefined, undefined);\n  }\n\n  BabylonDelegationHelper.depositDelegatedFunds = depositDelegatedFunds;\n\n  function deployManagerContract(server, keyStore, delegate, fee, amount, derivationPath = '') {\n    const code = `[ { \"prim\": \"parameter\",\n        \"args\":\n          [ { \"prim\": \"or\",\n              \"args\":\n                [ { \"prim\": \"lambda\",\n                    \"args\":\n                      [ { \"prim\": \"unit\" }, { \"prim\": \"list\", \"args\": [ { \"prim\": \"operation\" } ] } ], \"annots\": [ \"%do\" ] },\n                  { \"prim\": \"unit\", \"annots\": [ \"%default\" ] } ] } ] },\n      { \"prim\": \"storage\", \"args\": [ { \"prim\": \"key_hash\" } ] },\n      { \"prim\": \"code\",\n        \"args\":\n          [ [ [ [ { \"prim\": \"DUP\" }, { \"prim\": \"CAR\" },\n                  { \"prim\": \"DIP\", \"args\": [ [ { \"prim\": \"CDR\" } ] ] } ] ],\n              { \"prim\": \"IF_LEFT\",\n                \"args\":\n                  [ [ { \"prim\": \"PUSH\", \"args\": [ { \"prim\": \"mutez\" }, { \"int\": \"0\" } ] },\n                      { \"prim\": \"AMOUNT\" },\n                      [ [ { \"prim\": \"COMPARE\" }, { \"prim\": \"EQ\" } ],\n                        { \"prim\": \"IF\", \"args\": [ [], [ [ { \"prim\": \"UNIT\" }, { \"prim\": \"FAILWITH\" } ] ] ] } ],\n                      [ { \"prim\": \"DIP\", \"args\": [ [ { \"prim\": \"DUP\" } ] ] },\n                        { \"prim\": \"SWAP\" } ],\n                      { \"prim\": \"IMPLICIT_ACCOUNT\" },\n                      { \"prim\": \"ADDRESS\" },\n                      { \"prim\": \"SENDER\" },\n                      [ [ { \"prim\": \"COMPARE\" }, { \"prim\": \"EQ\" } ],\n                        { \"prim\": \"IF\", \"args\": [ [], [ [ { \"prim\": \"UNIT\" },{ \"prim\": \"FAILWITH\" } ] ] ] } ],\n                      { \"prim\": \"UNIT\" }, { \"prim\": \"EXEC\" },\n                      { \"prim\": \"PAIR\" } ],\n                    [ { \"prim\": \"DROP\" },\n                      { \"prim\": \"NIL\", \"args\": [ { \"prim\": \"operation\" } ] },\n                      { \"prim\": \"PAIR\" } ] ] } ] ] } ]`;\n    const storage = `{ \"string\": \"${keyStore.publicKeyHash}\" }`;\n    return TezosNodeWriter_1.TezosNodeWriter.sendContractOriginationOperation(server, keyStore, amount, delegate, fee, derivationPath, 600, 20000, code, storage, TezosTypes.TezosParameterFormat.Micheline);\n  }\n\n  BabylonDelegationHelper.deployManagerContract = deployManagerContract;\n})(BabylonDelegationHelper = exports.BabylonDelegationHelper || (exports.BabylonDelegationHelper = {}));","map":{"version":3,"sources":["../../../../src/chain/tezos/contracts/BabylonDelegationHelper.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\n    result[\"default\"] = mod;\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst blakejs = __importStar(require(\"blakejs\"));\nconst jsonpath_plus_1 = require(\"jsonpath-plus\");\nconst TezosLanguageUtil_1 = require(\"../TezosLanguageUtil\");\nconst TezosNodeReader_1 = require(\"../TezosNodeReader\");\nconst TezosNodeWriter_1 = require(\"../TezosNodeWriter\");\nconst TezosTypes = __importStar(require(\"../../../types/tezos/TezosChainTypes\"));\nconst TezosConstants_1 = require(\"../../../types/tezos/TezosConstants\");\nvar BabylonDelegationHelper;\n(function (BabylonDelegationHelper) {\n    function verifyDestination(server, address) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const contract = yield TezosNodeReader_1.TezosNodeReader.getAccountForBlock(server, 'head', address);\n            if (!!!contract.script) {\n                throw new Error(`No code found at ${address}`);\n            }\n            const k = Buffer.from(blakejs.blake2s(JSON.stringify(contract.script.code), null, 16)).toString('hex');\n            if (k !== 'd99cb8b4c7e40166f59c0f3c30724225') {\n                throw new Error(`Contract does not match the expected code hash: ${k}, 'd99cb8b4c7e40166f59c0f3c30724225'`);\n            }\n            return true;\n        });\n    }\n    BabylonDelegationHelper.verifyDestination = verifyDestination;\n    function verifyScript(script) {\n        const k = Buffer.from(blakejs.blake2s(TezosLanguageUtil_1.TezosLanguageUtil.preProcessMichelsonScript(script).join('\\n'), null, 16)).toString('hex');\n        if (k !== 'a585489ffaee60d07077059539d5bfc8') {\n            throw new Error(`Contract does not match the expected code hash: ${k}, 'a585489ffaee60d07077059539d5bfc8'`);\n        }\n        return true;\n    }\n    BabylonDelegationHelper.verifyScript = verifyScript;\n    function getSimpleStorage(server, address) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const storageResult = yield TezosNodeReader_1.TezosNodeReader.getContractStorage(server, address);\n            return { administrator: jsonpath_plus_1.JSONPath({ path: '$.string', json: storageResult })[0] };\n        });\n    }\n    BabylonDelegationHelper.getSimpleStorage = getSimpleStorage;\n    function setDelegate(server, keyStore, contract, delegate, fee, derivationPath = '') {\n        if (contract.startsWith('KT1')) {\n            const parameters = `[{ \"prim\": \"DROP\" }, { \"prim\": \"NIL\", \"args\": [{ \"prim\": \"operation\" }] }, { \"prim\": \"PUSH\", \"args\": [{ \"prim\": \"key_hash\" }, { \"string\": \"${delegate}\" } ] }, { \"prim\": \"SOME\" }, { \"prim\": \"SET_DELEGATE\" }, { \"prim\": \"CONS\" } ]`;\n            return TezosNodeWriter_1.TezosNodeWriter.sendContractInvocationOperation(server, keyStore, contract, 0, fee, derivationPath, 0, TezosConstants_1.TezosConstants.P005ManagerContractWithdrawalGasLimit, 'do', parameters, TezosTypes.TezosParameterFormat.Micheline);\n        }\n        else {\n            return TezosNodeWriter_1.TezosNodeWriter.sendDelegationOperation(server, keyStore, delegate, fee, derivationPath);\n        }\n    }\n    BabylonDelegationHelper.setDelegate = setDelegate;\n    function unSetDelegate(server, keyStore, contract, fee, derivationPath = '') {\n        if (contract.startsWith('KT1')) {\n            const parameters = `[{ \"prim\": \"DROP\" }, { \"prim\": \"NIL\", \"args\": [{ \"prim\": \"operation\" }] }, { \"prim\": \"NONE\", \"args\": [{ \"prim\": \"key_hash\" }] }, { \"prim\": \"SET_DELEGATE\" }, { \"prim\": \"CONS\" } ]`;\n            return TezosNodeWriter_1.TezosNodeWriter.sendContractInvocationOperation(server, keyStore, contract, 0, fee, derivationPath, 0, TezosConstants_1.TezosConstants.P005ManagerContractWithdrawalGasLimit, 'do', parameters, TezosTypes.TezosParameterFormat.Micheline);\n        }\n        else {\n            return TezosNodeWriter_1.TezosNodeWriter.sendUndelegationOperation(server, keyStore, fee, derivationPath);\n        }\n    }\n    BabylonDelegationHelper.unSetDelegate = unSetDelegate;\n    function withdrawDelegatedFunds(server, keyStore, contract, fee, amount, derivationPath = '') {\n        return sendDelegatedFunds(server, keyStore, contract, fee, amount, derivationPath, keyStore.publicKeyHash);\n    }\n    BabylonDelegationHelper.withdrawDelegatedFunds = withdrawDelegatedFunds;\n    function sendDelegatedFunds(server, keyStore, contract, fee, amount, derivationPath = '', destination) {\n        let parameters = `[ { \"prim\": \"DROP\" },\n            { \"prim\": \"NIL\", \"args\": [ { \"prim\": \"operation\" } ] },\n            { \"prim\": \"PUSH\", \"args\": [ { \"prim\": \"key_hash\" }, { \"string\": \"${destination}\" } ] },\n            { \"prim\": \"IMPLICIT_ACCOUNT\" },\n            { \"prim\": \"PUSH\", \"args\": [ { \"prim\": \"mutez\" }, { \"int\": \"${amount}\" } ] },\n            { \"prim\": \"UNIT\" },\n            { \"prim\": \"TRANSFER_TOKENS\" },\n            { \"prim\": \"CONS\" } ]`;\n        return TezosNodeWriter_1.TezosNodeWriter.sendContractInvocationOperation(server, keyStore, contract, 0, fee, derivationPath, TezosConstants_1.TezosConstants.P005ManagerContractWithdrawalStorageLimit, TezosConstants_1.TezosConstants.P005ManagerContractWithdrawalGasLimit, 'do', parameters, TezosTypes.TezosParameterFormat.Micheline);\n    }\n    BabylonDelegationHelper.sendDelegatedFunds = sendDelegatedFunds;\n    function depositDelegatedFunds(server, keyStore, contract, fee, amount, derivationPath = '') {\n        return TezosNodeWriter_1.TezosNodeWriter.sendContractInvocationOperation(server, keyStore, contract, amount, fee, derivationPath, 0, TezosConstants_1.TezosConstants.P005ManagerContractDepositGasLimit, undefined, undefined);\n    }\n    BabylonDelegationHelper.depositDelegatedFunds = depositDelegatedFunds;\n    function deployManagerContract(server, keyStore, delegate, fee, amount, derivationPath = '') {\n        const code = `[ { \"prim\": \"parameter\",\n        \"args\":\n          [ { \"prim\": \"or\",\n              \"args\":\n                [ { \"prim\": \"lambda\",\n                    \"args\":\n                      [ { \"prim\": \"unit\" }, { \"prim\": \"list\", \"args\": [ { \"prim\": \"operation\" } ] } ], \"annots\": [ \"%do\" ] },\n                  { \"prim\": \"unit\", \"annots\": [ \"%default\" ] } ] } ] },\n      { \"prim\": \"storage\", \"args\": [ { \"prim\": \"key_hash\" } ] },\n      { \"prim\": \"code\",\n        \"args\":\n          [ [ [ [ { \"prim\": \"DUP\" }, { \"prim\": \"CAR\" },\n                  { \"prim\": \"DIP\", \"args\": [ [ { \"prim\": \"CDR\" } ] ] } ] ],\n              { \"prim\": \"IF_LEFT\",\n                \"args\":\n                  [ [ { \"prim\": \"PUSH\", \"args\": [ { \"prim\": \"mutez\" }, { \"int\": \"0\" } ] },\n                      { \"prim\": \"AMOUNT\" },\n                      [ [ { \"prim\": \"COMPARE\" }, { \"prim\": \"EQ\" } ],\n                        { \"prim\": \"IF\", \"args\": [ [], [ [ { \"prim\": \"UNIT\" }, { \"prim\": \"FAILWITH\" } ] ] ] } ],\n                      [ { \"prim\": \"DIP\", \"args\": [ [ { \"prim\": \"DUP\" } ] ] },\n                        { \"prim\": \"SWAP\" } ],\n                      { \"prim\": \"IMPLICIT_ACCOUNT\" },\n                      { \"prim\": \"ADDRESS\" },\n                      { \"prim\": \"SENDER\" },\n                      [ [ { \"prim\": \"COMPARE\" }, { \"prim\": \"EQ\" } ],\n                        { \"prim\": \"IF\", \"args\": [ [], [ [ { \"prim\": \"UNIT\" },{ \"prim\": \"FAILWITH\" } ] ] ] } ],\n                      { \"prim\": \"UNIT\" }, { \"prim\": \"EXEC\" },\n                      { \"prim\": \"PAIR\" } ],\n                    [ { \"prim\": \"DROP\" },\n                      { \"prim\": \"NIL\", \"args\": [ { \"prim\": \"operation\" } ] },\n                      { \"prim\": \"PAIR\" } ] ] } ] ] } ]`;\n        const storage = `{ \"string\": \"${keyStore.publicKeyHash}\" }`;\n        return TezosNodeWriter_1.TezosNodeWriter.sendContractOriginationOperation(server, keyStore, amount, delegate, fee, derivationPath, 600, 20000, code, storage, TezosTypes.TezosParameterFormat.Micheline);\n    }\n    BabylonDelegationHelper.deployManagerContract = deployManagerContract;\n})(BabylonDelegationHelper = exports.BabylonDelegationHelper || (exports.BabylonDelegationHelper = {}));\n//# sourceMappingURL=BabylonDelegationHelper.js.map"]},"metadata":{},"sourceType":"script"}