{"ast":null,"code":"\"use strict\";\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\n  result[\"default\"] = mod;\n  return result;\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nconst blakejs = __importStar(require(\"blakejs\"));\n\nconst jsonpath_plus_1 = require(\"jsonpath-plus\");\n\nconst TezosMessageUtil_1 = require(\"../TezosMessageUtil\");\n\nconst TezosNodeReader_1 = require(\"../TezosNodeReader\");\n\nvar TCFBakerRegistryHelper;\n\n(function (TCFBakerRegistryHelper) {\n  function verifyDestination(server, address) {\n    return __awaiter(this, void 0, void 0, function* () {\n      const contract = yield TezosNodeReader_1.TezosNodeReader.getAccountForBlock(server, 'head', address);\n\n      if (!!!contract.script) {\n        throw new Error(`No code found at ${address}`);\n      }\n\n      const k = Buffer.from(blakejs.blake2s(contract['script'].toString(), null, 16)).toString('hex');\n\n      if (k !== '1527ddf08bdf582dce0b28c051044897') {\n        throw new Error(`Contract at ${address} does not match the expected code hash`);\n      }\n\n      return true;\n    });\n  }\n\n  TCFBakerRegistryHelper.verifyDestination = verifyDestination;\n\n  function getSimpleStorage(server, address) {\n    return __awaiter(this, void 0, void 0, function* () {\n      const storageResult = yield TezosNodeReader_1.TezosNodeReader.getContractStorage(server, address);\n      return {\n        mapid: parseInt(jsonpath_plus_1.JSONPath({\n          path: '$.args[0].int',\n          json: storageResult\n        })[0]),\n        owner: jsonpath_plus_1.JSONPath({\n          path: '$.args[1].args[0].string',\n          json: storageResult\n        })[0],\n        signupFee: parseInt(jsonpath_plus_1.JSONPath({\n          path: '$.args[1].args[1].args[0].int',\n          json: storageResult\n        })[0]),\n        updateFee: parseInt(jsonpath_plus_1.JSONPath({\n          path: '$.args[1].args[1].args[1].int',\n          json: storageResult\n        })[0])\n      };\n    });\n  }\n\n  TCFBakerRegistryHelper.getSimpleStorage = getSimpleStorage;\n\n  function updateRegistration(server, address, baker, name, isAcceptingDelegation, detailsURL, payoutShare) {\n    return __awaiter(this, void 0, void 0, function* () {});\n  }\n\n  TCFBakerRegistryHelper.updateRegistration = updateRegistration;\n\n  function queryRegistration(server, mapid, baker) {\n    return __awaiter(this, void 0, void 0, function* () {\n      const key = TezosMessageUtil_1.TezosMessageUtils.encodeBigMapKey(Buffer.from(TezosMessageUtil_1.TezosMessageUtils.writePackedData(baker, 'key_hash'), 'hex'));\n      const mapResult = yield TezosNodeReader_1.TezosNodeReader.getValueForBigMapKey(server, mapid, key);\n\n      if (!!!mapResult) {\n        return undefined;\n      }\n\n      const textDecoder = new TextDecoder();\n      const paymentConfigMask = Number(jsonpath_plus_1.JSONPath({\n        path: '$.args[0].args[0].args[0].args[1].args[1].args[1].args[0].args[1].int',\n        json: mapResult\n      })[0]);\n      return {\n        name: textDecoder.decode(Buffer.from(jsonpath_plus_1.JSONPath({\n          path: '$.args[0].args[0].args[0].args[0].args[0].args[0].bytes',\n          json: mapResult\n        })[0], 'hex')),\n        isAcceptingDelegation: Boolean(jsonpath_plus_1.JSONPath({\n          path: '$.args[0].args[0].args[0].args[0].args[0].args[1].prim',\n          json: mapResult\n        })[0]),\n        externalDataURL: textDecoder.decode(Buffer.from(jsonpath_plus_1.JSONPath({\n          path: '$.args[0].args[0].args[0].args[0].args[1].bytes',\n          json: mapResult\n        })[0], 'hex')),\n        split: Number(jsonpath_plus_1.JSONPath({\n          path: '$.args[0].args[0].args[0].args[1].args[0].args[0].int',\n          json: mapResult\n        })[0]) / 10000,\n        paymentAccounts: jsonpath_plus_1.JSONPath({\n          path: '$.args[0].args[0].args[0].args[1].args[0].args[1]..string',\n          json: mapResult\n        }),\n        minimumDelegation: Number(jsonpath_plus_1.JSONPath({\n          path: '$.args[0].args[0].args[0].args[1].args[1].args[0].args[0].args[0].int',\n          json: mapResult\n        })[0]),\n        isGreedy: Boolean(jsonpath_plus_1.JSONPath({\n          path: '$.args[0].args[0].args[0].args[1].args[1].args[0].args[0].args[1].prim',\n          json: mapResult\n        })[0]),\n        payoutDelay: Number(jsonpath_plus_1.JSONPath({\n          path: '$.args[0].args[0].args[0].args[1].args[1].args[0].args[1].args[0].int',\n          json: mapResult\n        })[0]),\n        payoutFrequency: Number(jsonpath_plus_1.JSONPath({\n          path: '$.args[0].args[0].args[0].args[1].args[1].args[0].args[1].args[1].args[0].int',\n          json: mapResult\n        })[0]),\n        minimumPayout: Number(jsonpath_plus_1.JSONPath({\n          path: '$.args[0].args[0].args[0].args[1].args[1].args[0].args[1].args[1].args[1].int',\n          json: mapResult\n        })[0]),\n        isCheap: Boolean(jsonpath_plus_1.JSONPath({\n          path: '$.args[0].args[0].args[0].args[1].args[1].args[1].args[0].args[0].prim',\n          json: mapResult\n        })[0]),\n        paymentConfig: {\n          payForOwnBlocks: Boolean(paymentConfigMask & 1),\n          payForEndorsements: Boolean(paymentConfigMask & 2),\n          payGainedFees: Boolean(paymentConfigMask & 4),\n          payForAccusationGains: Boolean(paymentConfigMask & 8),\n          subtractLostDepositsWhenAccused: Boolean(paymentConfigMask & 16),\n          subtractLostRewardsWhenAccused: Boolean(paymentConfigMask & 32),\n          subtractLostFeesWhenAccused: Boolean(paymentConfigMask & 64),\n          payForRevelation: Boolean(paymentConfigMask & 128),\n          subtractLostRewardsWhenMissRevelation: Boolean(paymentConfigMask & 256),\n          subtractLostFeesWhenMissRevelation: Boolean(paymentConfigMask & 512),\n          compensateMissedBlocks: !Boolean(paymentConfigMask & 1024),\n          payForStolenBlocks: Boolean(paymentConfigMask & 2048),\n          compensateMissedEndorsements: !Boolean(paymentConfigMask & 4096),\n          compensateLowPriorityEndorsementLoss: !Boolean(paymentConfigMask & 8192)\n        },\n        overdelegationThreshold: Number(jsonpath_plus_1.JSONPath({\n          path: '$.args[0].args[0].args[0].args[1].args[1].args[1].args[1].args[0].int',\n          json: mapResult\n        })[0]),\n        subtractRewardsFromUninvitedDelegation: Boolean(jsonpath_plus_1.JSONPath({\n          path: '$.args[0].args[0].args[0].args[1].args[1].args[1].args[1].args[1].prim',\n          json: mapResult\n        })[0]),\n        recordManager: jsonpath_plus_1.JSONPath({\n          path: '$.args[0].args[1].args[0].string',\n          json: mapResult\n        })[0],\n        timestamp: new Date(jsonpath_plus_1.JSONPath({\n          path: '$.args[1].string',\n          json: mapResult\n        })[0])\n      };\n    });\n  }\n\n  TCFBakerRegistryHelper.queryRegistration = queryRegistration;\n})(TCFBakerRegistryHelper = exports.TCFBakerRegistryHelper || (exports.TCFBakerRegistryHelper = {}));","map":{"version":3,"sources":["../../../../src/chain/tezos/contracts/TCFBakerRegistryHelper.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\n    result[\"default\"] = mod;\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst blakejs = __importStar(require(\"blakejs\"));\nconst jsonpath_plus_1 = require(\"jsonpath-plus\");\nconst TezosMessageUtil_1 = require(\"../TezosMessageUtil\");\nconst TezosNodeReader_1 = require(\"../TezosNodeReader\");\nvar TCFBakerRegistryHelper;\n(function (TCFBakerRegistryHelper) {\n    function verifyDestination(server, address) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const contract = yield TezosNodeReader_1.TezosNodeReader.getAccountForBlock(server, 'head', address);\n            if (!!!contract.script) {\n                throw new Error(`No code found at ${address}`);\n            }\n            const k = Buffer.from(blakejs.blake2s(contract['script'].toString(), null, 16)).toString('hex');\n            if (k !== '1527ddf08bdf582dce0b28c051044897') {\n                throw new Error(`Contract at ${address} does not match the expected code hash`);\n            }\n            return true;\n        });\n    }\n    TCFBakerRegistryHelper.verifyDestination = verifyDestination;\n    function getSimpleStorage(server, address) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const storageResult = yield TezosNodeReader_1.TezosNodeReader.getContractStorage(server, address);\n            return {\n                mapid: parseInt(jsonpath_plus_1.JSONPath({ path: '$.args[0].int', json: storageResult })[0]),\n                owner: jsonpath_plus_1.JSONPath({ path: '$.args[1].args[0].string', json: storageResult })[0],\n                signupFee: parseInt(jsonpath_plus_1.JSONPath({ path: '$.args[1].args[1].args[0].int', json: storageResult })[0]),\n                updateFee: parseInt(jsonpath_plus_1.JSONPath({ path: '$.args[1].args[1].args[1].int', json: storageResult })[0])\n            };\n        });\n    }\n    TCFBakerRegistryHelper.getSimpleStorage = getSimpleStorage;\n    function updateRegistration(server, address, baker, name, isAcceptingDelegation, detailsURL, payoutShare) {\n        return __awaiter(this, void 0, void 0, function* () {\n        });\n    }\n    TCFBakerRegistryHelper.updateRegistration = updateRegistration;\n    function queryRegistration(server, mapid, baker) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const key = TezosMessageUtil_1.TezosMessageUtils.encodeBigMapKey(Buffer.from(TezosMessageUtil_1.TezosMessageUtils.writePackedData(baker, 'key_hash'), 'hex'));\n            const mapResult = yield TezosNodeReader_1.TezosNodeReader.getValueForBigMapKey(server, mapid, key);\n            if (!!!mapResult) {\n                return undefined;\n            }\n            const textDecoder = new TextDecoder();\n            const paymentConfigMask = Number(jsonpath_plus_1.JSONPath({ path: '$.args[0].args[0].args[0].args[1].args[1].args[1].args[0].args[1].int', json: mapResult })[0]);\n            return {\n                name: textDecoder.decode(Buffer.from(jsonpath_plus_1.JSONPath({ path: '$.args[0].args[0].args[0].args[0].args[0].args[0].bytes', json: mapResult })[0], 'hex')),\n                isAcceptingDelegation: Boolean(jsonpath_plus_1.JSONPath({ path: '$.args[0].args[0].args[0].args[0].args[0].args[1].prim', json: mapResult })[0]),\n                externalDataURL: textDecoder.decode(Buffer.from(jsonpath_plus_1.JSONPath({ path: '$.args[0].args[0].args[0].args[0].args[1].bytes', json: mapResult })[0], 'hex')),\n                split: Number(jsonpath_plus_1.JSONPath({ path: '$.args[0].args[0].args[0].args[1].args[0].args[0].int', json: mapResult })[0]) / 10000,\n                paymentAccounts: jsonpath_plus_1.JSONPath({ path: '$.args[0].args[0].args[0].args[1].args[0].args[1]..string', json: mapResult }),\n                minimumDelegation: Number(jsonpath_plus_1.JSONPath({ path: '$.args[0].args[0].args[0].args[1].args[1].args[0].args[0].args[0].int', json: mapResult })[0]),\n                isGreedy: Boolean(jsonpath_plus_1.JSONPath({ path: '$.args[0].args[0].args[0].args[1].args[1].args[0].args[0].args[1].prim', json: mapResult })[0]),\n                payoutDelay: Number(jsonpath_plus_1.JSONPath({ path: '$.args[0].args[0].args[0].args[1].args[1].args[0].args[1].args[0].int', json: mapResult })[0]),\n                payoutFrequency: Number(jsonpath_plus_1.JSONPath({ path: '$.args[0].args[0].args[0].args[1].args[1].args[0].args[1].args[1].args[0].int', json: mapResult })[0]),\n                minimumPayout: Number(jsonpath_plus_1.JSONPath({ path: '$.args[0].args[0].args[0].args[1].args[1].args[0].args[1].args[1].args[1].int', json: mapResult })[0]),\n                isCheap: Boolean(jsonpath_plus_1.JSONPath({ path: '$.args[0].args[0].args[0].args[1].args[1].args[1].args[0].args[0].prim', json: mapResult })[0]),\n                paymentConfig: {\n                    payForOwnBlocks: Boolean(paymentConfigMask & 1),\n                    payForEndorsements: Boolean(paymentConfigMask & 2),\n                    payGainedFees: Boolean(paymentConfigMask & 4),\n                    payForAccusationGains: Boolean(paymentConfigMask & 8),\n                    subtractLostDepositsWhenAccused: Boolean(paymentConfigMask & 16),\n                    subtractLostRewardsWhenAccused: Boolean(paymentConfigMask & 32),\n                    subtractLostFeesWhenAccused: Boolean(paymentConfigMask & 64),\n                    payForRevelation: Boolean(paymentConfigMask & 128),\n                    subtractLostRewardsWhenMissRevelation: Boolean(paymentConfigMask & 256),\n                    subtractLostFeesWhenMissRevelation: Boolean(paymentConfigMask & 512),\n                    compensateMissedBlocks: !Boolean(paymentConfigMask & 1024),\n                    payForStolenBlocks: Boolean(paymentConfigMask & 2048),\n                    compensateMissedEndorsements: !Boolean(paymentConfigMask & 4096),\n                    compensateLowPriorityEndorsementLoss: !Boolean(paymentConfigMask & 8192)\n                },\n                overdelegationThreshold: Number(jsonpath_plus_1.JSONPath({ path: '$.args[0].args[0].args[0].args[1].args[1].args[1].args[1].args[0].int', json: mapResult })[0]),\n                subtractRewardsFromUninvitedDelegation: Boolean(jsonpath_plus_1.JSONPath({ path: '$.args[0].args[0].args[0].args[1].args[1].args[1].args[1].args[1].prim', json: mapResult })[0]),\n                recordManager: jsonpath_plus_1.JSONPath({ path: '$.args[0].args[1].args[0].string', json: mapResult })[0],\n                timestamp: new Date(jsonpath_plus_1.JSONPath({ path: '$.args[1].string', json: mapResult })[0])\n            };\n        });\n    }\n    TCFBakerRegistryHelper.queryRegistration = queryRegistration;\n})(TCFBakerRegistryHelper = exports.TCFBakerRegistryHelper || (exports.TCFBakerRegistryHelper = {}));\n//# sourceMappingURL=TCFBakerRegistryHelper.js.map"]},"metadata":{},"sourceType":"script"}