import{nanoid as e}from"nanoid";import{TezosToolkit as r,createTransferOperation as t,createOriginationOperation as n,createSetDelegateOperation as o}from"@taquito/taquito";var a,i,s;function u(){return(u=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)}function c(e,r){e.prototype=Object.create(r.prototype),e.prototype.constructor=e,e.__proto__=r}function p(e,r){if(null==e)return{};var t,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r.indexOf(t=a[n])>=0||(o[t]=e[t]);return o}!function(e){e.PermissionRequest="PERMISSION_REQUEST",e.PermissionResponse="PERMISSION_RESPONSE",e.OperationRequest="OPERATION_REQUEST",e.OperationResponse="OPERATION_RESPONSE"}(a||(a={})),function(e){e.NotGranted="NOT_GRANTED",e.NotFound="NOT_FOUND",e.InvalidParams="INVALID_PARAMS"}(i||(i={})),function(e){e.Request="THANOS_PAGE_REQUEST",e.Response="THANOS_PAGE_RESPONSE",e.ErrorResponse="THANOS_PAGE_ERROR_RESPONSE"}(s||(s={}));var l=function(e,r){try{return Promise.resolve(h({type:a.OperationRequest,sourcePkh:e,opParams:r})).then(function(e){return d(e.type===a.OperationResponse),e.opHash})}catch(e){return Promise.reject(e)}},m=function(e,r,t){try{return Promise.resolve(h({type:a.PermissionRequest,network:e,appMeta:r,force:t})).then(function(e){return d(e.type===a.PermissionResponse),{pkh:e.pkh,rpc:e.rpc}})}catch(e){return Promise.reject(e)}};function f(){return new Promise(function(e){var r=function(e){var r,n;e.source===window&&(null===(r=e.data)||void 0===r?void 0:r.type)===s.Response&&"PONG"===(null===(n=e.data)||void 0===n?void 0:n.payload)&&t(!0)},t=function(t){e(t),window.removeEventListener("message",r),clearTimeout(n)};P({type:s.Request,payload:"PING"}),window.addEventListener("message",r);var n=setTimeout(function(){return t(!1)},500)})}function v(e){var r,t=!1;return function n(o){void 0===o&&(o=0);try{var a=o<5;return Promise.resolve(f()).then(function(i){t!==i&&(e(i),t=i),r=setTimeout(n,i?1e4:a?0:5e3,a?o+1:o)})}catch(e){return Promise.reject(e)}}(),function(){return clearTimeout(r)}}function h(r){return new Promise(function(t,n){var o=e();P({type:s.Request,payload:r,reqId:o}),window.addEventListener("message",function e(r){var a=r.data;switch(!0){case r.source!==window||(null==a?void 0:a.reqId)!==o:return;case(null==a?void 0:a.type)===s.Response:t(a.payload),window.removeEventListener("message",e);break;case(null==a?void 0:a.type)===s.ErrorResponse:n(function(e){switch(!0){case e===i.NotGranted:return new E;case e===i.NotFound:return new w;case e===i.InvalidParams:return new R;case null==e?void 0:e.startsWith("__tezos__"):return new Error(e.replace("__tezos__",""));default:return new y}}(a.payload)),window.removeEventListener("message",e)}})})}function d(e){if(!e)throw new Error("Invalid response recieved")}function P(e){window.postMessage(e,"*")}var y=function(){this.name="ThanosWalletError",this.message="An unknown error occured. Please try again or report it"},E=function(e){function r(){var r;return(r=e.apply(this,arguments)||this).name="NotGrantedThanosWalletError",r.message="Permission Not Granted",r}return c(r,e),r}(y),w=function(e){function r(){var r;return(r=e.apply(this,arguments)||this).name="NotFoundThanosWalletError",r.message="Account Not Found. Try connect again",r}return c(r,e),r}(y),R=function(e){function r(){var r;return(r=e.apply(this,arguments)||this).name="InvalidParamsThanosWalletError",r.message="Some of the parameters you provided are invalid",r}return c(r,e),r}(y),O=function(){function e(e){this.appName=e}var a,i=e.prototype;return i.toTezos=function(){_(this.pkh);var e=new r;return e.setProvider({wallet:this,rpc:this.rpc}),e},i.connect=function(e,r){void 0===r&&(r={forcePermission:!1});try{var t=this;return Promise.resolve(m(e,{name:t.appName},r.forcePermission)).then(function(e){var r=e.rpc;t.pkh=e.pkh,t.rpc=r})}catch(e){return Promise.reject(e)}},i.getPKH=function(){try{return _(this.pkh),Promise.resolve(this.pkh)}catch(e){return Promise.reject(e)}},i.mapTransferParamsToWalletParams=function(e){try{return Promise.resolve(t(e))}catch(e){return Promise.reject(e)}},i.mapOriginateParamsToWalletParams=function(e){try{return Promise.resolve(n(e))}catch(e){return Promise.reject(e)}},i.mapDelegateParamsToWalletParams=function(e){try{return Promise.resolve(o(e))}catch(e){return Promise.reject(e)}},i.sendOperations=function(e){try{return _(this.pkh),Promise.resolve(l(this.pkh,e.map(T)))}catch(e){return Promise.reject(e)}},(a=[{key:"connected",get:function(){return Boolean(this.pkh)}}])&&function(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(e.prototype,a),e}();O.isAvailable=f,O.onAvailabilityChange=v;var N=function(e){function r(){var r;return(r=e.apply(this,arguments)||this).name="ThanosWalletNotConnected",r.message="You need to connect ThanosWallet by calling thanosWallet.connect() first",r}return c(r,e),r}(y);function _(e){if(!e)throw new N}function T(e){var r=p(e,["fee","gas_limit","storage_limit"]);if("transaction"===e.kind){var t=r.destination,n=r.amount,o=r.parameters;return u({},p(r,["destination","amount","parameters"]),{to:t,amount:+n,mutez:!0,parameter:o})}return r}export{R as InvalidParamsThanosWalletError,N as NotConnectedThanosWalletError,w as NotFoundThanosWalletError,E as NotGrantedThanosWalletError,i as ThanosDAppErrorType,a as ThanosDAppMessageType,s as ThanosPageMessageType,O as ThanosWallet,y as ThanosWalletError,f as isAvailable,v as onAvailabilityChange,l as requestOperation,m as requestPermission};
//# sourceMappingURL=index.module.js.map
