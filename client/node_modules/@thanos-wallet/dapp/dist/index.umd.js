!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("nanoid"),require("@taquito/taquito")):"function"==typeof define&&define.amd?define(["exports","nanoid","@taquito/taquito"],r):r((e=e||self).dapp={},e.nanoid,e.taquito)}(this,function(e,r,n){var t,o,a;function s(){return(s=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e}).apply(this,arguments)}function i(e,r){e.prototype=Object.create(r.prototype),e.prototype.constructor=e,e.__proto__=r}function u(e,r){if(null==e)return{};var n,t,o={},a=Object.keys(e);for(t=0;t<a.length;t++)r.indexOf(n=a[t])>=0||(o[n]=e[n]);return o}(t=e.ThanosDAppMessageType||(e.ThanosDAppMessageType={})).PermissionRequest="PERMISSION_REQUEST",t.PermissionResponse="PERMISSION_RESPONSE",t.OperationRequest="OPERATION_REQUEST",t.OperationResponse="OPERATION_RESPONSE",(o=e.ThanosDAppErrorType||(e.ThanosDAppErrorType={})).NotGranted="NOT_GRANTED",o.NotFound="NOT_FOUND",o.InvalidParams="INVALID_PARAMS",(a=e.ThanosPageMessageType||(e.ThanosPageMessageType={})).Request="THANOS_PAGE_REQUEST",a.Response="THANOS_PAGE_RESPONSE",a.ErrorResponse="THANOS_PAGE_ERROR_RESPONSE";var p=function(r,n){try{return Promise.resolve(m({type:e.ThanosDAppMessageType.OperationRequest,sourcePkh:r,opParams:n})).then(function(r){return f(r.type===e.ThanosDAppMessageType.OperationResponse),r.opHash})}catch(e){return Promise.reject(e)}},c=function(r,n,t){try{return Promise.resolve(m({type:e.ThanosDAppMessageType.PermissionRequest,network:r,appMeta:n,force:t})).then(function(r){return f(r.type===e.ThanosDAppMessageType.PermissionResponse),{pkh:r.pkh,rpc:r.rpc}})}catch(e){return Promise.reject(e)}};function l(){return new Promise(function(r){var n=function(r){var n,o;r.source===window&&(null===(n=r.data)||void 0===n?void 0:n.type)===e.ThanosPageMessageType.Response&&"PONG"===(null===(o=r.data)||void 0===o?void 0:o.payload)&&t(!0)},t=function(e){r(e),window.removeEventListener("message",n),clearTimeout(o)};d({type:e.ThanosPageMessageType.Request,payload:"PING"}),window.addEventListener("message",n);var o=setTimeout(function(){return t(!1)},500)})}function h(e){var r,n=!1;return function t(o){void 0===o&&(o=0);try{var a=o<5;return Promise.resolve(l()).then(function(s){n!==s&&(e(s),n=s),r=setTimeout(t,s?1e4:a?0:5e3,a?o+1:o)})}catch(e){return Promise.reject(e)}}(),function(){return clearTimeout(r)}}function m(n){return new Promise(function(t,o){var a=r.nanoid();d({type:e.ThanosPageMessageType.Request,payload:n,reqId:a}),window.addEventListener("message",function r(n){var s=n.data;switch(!0){case n.source!==window||(null==s?void 0:s.reqId)!==a:return;case(null==s?void 0:s.type)===e.ThanosPageMessageType.Response:t(s.payload),window.removeEventListener("message",r);break;case(null==s?void 0:s.type)===e.ThanosPageMessageType.ErrorResponse:o(function(r){switch(!0){case r===e.ThanosDAppErrorType.NotGranted:return new v;case r===e.ThanosDAppErrorType.NotFound:return new y;case r===e.ThanosDAppErrorType.InvalidParams:return new P;case null==r?void 0:r.startsWith("__tezos__"):return new Error(r.replace("__tezos__",""));default:return new T}}(s.payload)),window.removeEventListener("message",r)}})})}function f(e){if(!e)throw new Error("Invalid response recieved")}function d(e){window.postMessage(e,"*")}var T=function(){this.name="ThanosWalletError",this.message="An unknown error occured. Please try again or report it"},v=function(e){function r(){var r;return(r=e.apply(this,arguments)||this).name="NotGrantedThanosWalletError",r.message="Permission Not Granted",r}return i(r,e),r}(T),y=function(e){function r(){var r;return(r=e.apply(this,arguments)||this).name="NotFoundThanosWalletError",r.message="Account Not Found. Try connect again",r}return i(r,e),r}(T),P=function(e){function r(){var r;return(r=e.apply(this,arguments)||this).name="InvalidParamsThanosWalletError",r.message="Some of the parameters you provided are invalid",r}return i(r,e),r}(T),g=function(){function e(e){this.appName=e}var r,t=e.prototype;return t.toTezos=function(){O(this.pkh);var e=new n.TezosToolkit;return e.setProvider({wallet:this,rpc:this.rpc}),e},t.connect=function(e,r){void 0===r&&(r={forcePermission:!1});try{var n=this;return Promise.resolve(c(e,{name:n.appName},r.forcePermission)).then(function(e){var r=e.rpc;n.pkh=e.pkh,n.rpc=r})}catch(e){return Promise.reject(e)}},t.getPKH=function(){try{return O(this.pkh),Promise.resolve(this.pkh)}catch(e){return Promise.reject(e)}},t.mapTransferParamsToWalletParams=function(e){try{return Promise.resolve(n.createTransferOperation(e))}catch(e){return Promise.reject(e)}},t.mapOriginateParamsToWalletParams=function(e){try{return Promise.resolve(n.createOriginationOperation(e))}catch(e){return Promise.reject(e)}},t.mapDelegateParamsToWalletParams=function(e){try{return Promise.resolve(n.createSetDelegateOperation(e))}catch(e){return Promise.reject(e)}},t.sendOperations=function(e){try{return O(this.pkh),Promise.resolve(p(this.pkh,e.map(w)))}catch(e){return Promise.reject(e)}},(r=[{key:"connected",get:function(){return Boolean(this.pkh)}}])&&function(e,r){for(var n=0;n<r.length;n++){var t=r[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}(e.prototype,r),e}();g.isAvailable=l,g.onAvailabilityChange=h;var E=function(e){function r(){var r;return(r=e.apply(this,arguments)||this).name="ThanosWalletNotConnected",r.message="You need to connect ThanosWallet by calling thanosWallet.connect() first",r}return i(r,e),r}(T);function O(e){if(!e)throw new E}function w(e){var r=u(e,["fee","gas_limit","storage_limit"]);if("transaction"===e.kind){var n=r.destination,t=r.amount,o=r.parameters;return s({},u(r,["destination","amount","parameters"]),{to:n,amount:+t,mutez:!0,parameter:o})}return r}e.InvalidParamsThanosWalletError=P,e.NotConnectedThanosWalletError=E,e.NotFoundThanosWalletError=y,e.NotGrantedThanosWalletError=v,e.ThanosWallet=g,e.ThanosWalletError=T,e.isAvailable=l,e.onAvailabilityChange=h,e.requestOperation=p,e.requestPermission=c});
//# sourceMappingURL=index.umd.js.map
