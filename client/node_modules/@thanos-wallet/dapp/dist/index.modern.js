import{nanoid as e}from"nanoid";import{TezosToolkit as t,createTransferOperation as n,createOriginationOperation as s,createSetDelegateOperation as o}from"@taquito/taquito";var r,a,i;function c(){return new Promise(e=>{const t=e=>{var t,s;e.source===window&&(null===(t=e.data)||void 0===t?void 0:t.type)===i.Response&&"PONG"===(null===(s=e.data)||void 0===s?void 0:s.payload)&&n(!0)},n=n=>{e(n),window.removeEventListener("message",t),clearTimeout(s)};h({type:i.Request,payload:"PING"}),window.addEventListener("message",t);const s=setTimeout(()=>n(!1),500)})}function u(e){let t,n=!1;const s=async(o=0)=>{const r=o<5,a=await c();n!==a&&(e(a),n=a),t=setTimeout(s,a?1e4:r?0:5e3,r?o+1:o)};return s(),()=>clearTimeout(t)}async function p(e,t,n){const s=await d({type:r.PermissionRequest,network:e,appMeta:t,force:n});return m(s.type===r.PermissionResponse),{pkh:s.pkh,rpc:s.rpc}}async function l(e,t){const n=await d({type:r.OperationRequest,sourcePkh:e,opParams:t});return m(n.type===r.OperationResponse),n.opHash}function d(t){return new Promise((n,s)=>{const o=e(),r=e=>{const t=e.data;switch(!0){case e.source!==window||(null==t?void 0:t.reqId)!==o:return;case(null==t?void 0:t.type)===i.Response:n(t.payload),window.removeEventListener("message",r);break;case(null==t?void 0:t.type)===i.ErrorResponse:s(function(e){switch(!0){case e===a.NotGranted:return new P;case e===a.NotFound:return new E;case e===a.InvalidParams:return new R;case null==e?void 0:e.startsWith("__tezos__"):return new Error(e.replace("__tezos__",""));default:return new w}}(t.payload)),window.removeEventListener("message",r)}};h({type:i.Request,payload:t,reqId:o}),window.addEventListener("message",r)})}function m(e){if(!e)throw new Error("Invalid response recieved")}function h(e){window.postMessage(e,"*")}!function(e){e.PermissionRequest="PERMISSION_REQUEST",e.PermissionResponse="PERMISSION_RESPONSE",e.OperationRequest="OPERATION_REQUEST",e.OperationResponse="OPERATION_RESPONSE"}(r||(r={})),function(e){e.NotGranted="NOT_GRANTED",e.NotFound="NOT_FOUND",e.InvalidParams="INVALID_PARAMS"}(a||(a={})),function(e){e.Request="THANOS_PAGE_REQUEST",e.Response="THANOS_PAGE_RESPONSE",e.ErrorResponse="THANOS_PAGE_ERROR_RESPONSE"}(i||(i={}));class w{constructor(){this.name="ThanosWalletError",this.message="An unknown error occured. Please try again or report it"}}class P extends w{constructor(){super(...arguments),this.name="NotGrantedThanosWalletError",this.message="Permission Not Granted"}}class E extends w{constructor(){super(...arguments),this.name="NotFoundThanosWalletError",this.message="Account Not Found. Try connect again"}}class R extends w{constructor(){super(...arguments),this.name="InvalidParamsThanosWalletError",this.message="Some of the parameters you provided are invalid"}}class N{constructor(e){this.appName=e}get connected(){return Boolean(this.pkh)}toTezos(){y(this.pkh);const e=new t;return e.setProvider({wallet:this,rpc:this.rpc}),e}async connect(e,t={forcePermission:!1}){const{pkh:n,rpc:s}=await p(e,{name:this.appName},t.forcePermission);this.pkh=n,this.rpc=s}async getPKH(){return y(this.pkh),this.pkh}async mapTransferParamsToWalletParams(e){return n(e)}async mapOriginateParamsToWalletParams(e){return s(e)}async mapDelegateParamsToWalletParams(e){return o(e)}async sendOperations(e){return y(this.pkh),l(this.pkh,e.map(T))}}N.isAvailable=c,N.onAvailabilityChange=u;class v extends w{constructor(){super(...arguments),this.name="ThanosWalletNotConnected",this.message="You need to connect ThanosWallet by calling thanosWallet.connect() first"}}function y(e){if(!e)throw new v}function T(e){const{...t}=e;if("transaction"===e.kind){const{destination:e,amount:n,parameters:s,...o}=t;return{...o,to:e,amount:+n,mutez:!0,parameter:s}}return t}export{R as InvalidParamsThanosWalletError,v as NotConnectedThanosWalletError,E as NotFoundThanosWalletError,P as NotGrantedThanosWalletError,a as ThanosDAppErrorType,r as ThanosDAppMessageType,i as ThanosPageMessageType,N as ThanosWallet,w as ThanosWalletError,c as isAvailable,u as onAvailabilityChange,l as requestOperation,p as requestPermission};
//# sourceMappingURL=index.modern.js.map
